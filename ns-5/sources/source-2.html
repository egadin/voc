


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > Function</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/highlight-idea.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.python.java</a>
</div>

<h1>Coverage Summary for Class: Function (org.python.java)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">Function</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/10)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/190)
  </span>
</td>
</tr>
  <tr>
    <td class="name">Function$MatchType</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/8)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/12)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/198)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<div class="sourceCode" id="sourceCode"><i class="no-highlight">1</i>&nbsp;package org.python.java;
<i class="no-highlight">2</i>&nbsp;
<i class="no-highlight">3</i>&nbsp;public class Function extends org.python.types.Object implements org.python.Callable {
<i class="no-highlight">4</i>&nbsp;    java.lang.Class klass;
<i class="no-highlight">5</i>&nbsp;    java.lang.String name;
<i class="no-highlight">6</i>&nbsp;    java.util.Map&lt;java.lang.String, java.lang.reflect.Method&gt; methods;
<i class="no-highlight">7</i>&nbsp;
<i class="no-highlight">8</i>&nbsp;    /**
<i class="no-highlight">9</i>&nbsp;     * Convert a Java klass into a string-based descriptor of the type.
<i class="no-highlight">10</i>&nbsp;     * For example:
<i class="no-highlight">11</i>&nbsp;     *  - an argument of type int -&gt; I
<i class="no-highlight">12</i>&nbsp;     *  - an argument of type java.lang.Integer -&gt; I
<i class="no-highlight">13</i>&nbsp;     *  - an argument of type foo.bar.Whiz -&gt; Lfoor/bar/whiz;
<i class="no-highlight">14</i>&nbsp;     *
<i class="no-highlight">15</i>&nbsp;     * This method makes one extension to the standard definition, and
<i class="no-highlight">16</i>&nbsp;     * converts a klass of null into &quot;0&quot;. This is required so that
<i class="no-highlight">17</i>&nbsp;     * it is possible to map a list of actual arguments to a signature.
<i class="no-highlight">18</i>&nbsp;     */
<i class="no-highlight">19</i>&nbsp;    public static java.lang.String descriptor(java.lang.Class klass) {
<b class="nc"><i class="no-highlight">20</i>&nbsp;        if (klass == null) {</b>
<b class="nc"><i class="no-highlight">21</i>&nbsp;            return &quot;0&quot;;</b>
<b class="nc"><i class="no-highlight">22</i>&nbsp;        } else if (klass.getName().startsWith(&quot;[&quot;)) {</b>
<b class="nc"><i class="no-highlight">23</i>&nbsp;            return klass.getName();</b>
<b class="nc"><i class="no-highlight">24</i>&nbsp;        } else if (klass == java.lang.Boolean.TYPE</b>
<i class="no-highlight">25</i>&nbsp;                || klass == java.lang.Boolean.class) {
<b class="nc"><i class="no-highlight">26</i>&nbsp;            return &quot;Z&quot;;</b>
<b class="nc"><i class="no-highlight">27</i>&nbsp;        } else if (klass == java.lang.Byte.TYPE</b>
<i class="no-highlight">28</i>&nbsp;                || klass == java.lang.Byte.class) {
<b class="nc"><i class="no-highlight">29</i>&nbsp;            return &quot;B&quot;;</b>
<b class="nc"><i class="no-highlight">30</i>&nbsp;        } else if (klass == java.lang.Character.TYPE</b>
<i class="no-highlight">31</i>&nbsp;                || klass == java.lang.Character.class) {
<b class="nc"><i class="no-highlight">32</i>&nbsp;            return &quot;C&quot;;</b>
<b class="nc"><i class="no-highlight">33</i>&nbsp;        } else if (klass == java.lang.Short.TYPE</b>
<i class="no-highlight">34</i>&nbsp;                || klass == java.lang.Short.class) {
<b class="nc"><i class="no-highlight">35</i>&nbsp;            return &quot;S&quot;;</b>
<b class="nc"><i class="no-highlight">36</i>&nbsp;        } else if (klass == java.lang.Integer.TYPE</b>
<i class="no-highlight">37</i>&nbsp;                || klass == java.lang.Integer.class) {
<b class="nc"><i class="no-highlight">38</i>&nbsp;            return &quot;I&quot;;</b>
<b class="nc"><i class="no-highlight">39</i>&nbsp;        } else if (klass == java.lang.Long.TYPE</b>
<i class="no-highlight">40</i>&nbsp;                || klass == java.lang.Long.class) {
<b class="nc"><i class="no-highlight">41</i>&nbsp;            return &quot;J&quot;;</b>
<b class="nc"><i class="no-highlight">42</i>&nbsp;        } else if (klass == java.lang.Float.TYPE</b>
<i class="no-highlight">43</i>&nbsp;                || klass == java.lang.Float.class) {
<b class="nc"><i class="no-highlight">44</i>&nbsp;            return &quot;F&quot;;</b>
<b class="nc"><i class="no-highlight">45</i>&nbsp;        } else if (klass == java.lang.Double.TYPE</b>
<i class="no-highlight">46</i>&nbsp;                || klass == java.lang.Double.class) {
<b class="nc"><i class="no-highlight">47</i>&nbsp;            return &quot;D&quot;;</b>
<i class="no-highlight">48</i>&nbsp;        } else {
<b class="nc"><i class="no-highlight">49</i>&nbsp;            return &quot;L&quot; + klass.getName().replace(&#39;.&#39;, &#39;/&#39;) + &quot;;&quot;;</b>
<i class="no-highlight">50</i>&nbsp;        }
<i class="no-highlight">51</i>&nbsp;    }
<i class="no-highlight">52</i>&nbsp;
<i class="no-highlight">53</i>&nbsp;    /* Arguments and parameters can match with different levels of compatibility. */
<b class="nc"><i class="no-highlight">54</i>&nbsp;    public enum MatchType {</b>
<i class="no-highlight">55</i>&nbsp;        /* No match - types are incompatible */
<b class="nc"><i class="no-highlight">56</i>&nbsp;        NO_MATCH,</b>
<i class="no-highlight">57</i>&nbsp;
<i class="no-highlight">58</i>&nbsp;        /* Loose cast match - Types can be cast into each other, but there will
<i class="no-highlight">59</i>&nbsp;         * likely be a loss of precision.
<i class="no-highlight">60</i>&nbsp;         * e.g., passing a float to foo(int x)
<i class="no-highlight">61</i>&nbsp;         */
<b class="nc"><i class="no-highlight">62</i>&nbsp;        LOOSE_CAST_MATCH,</b>
<i class="no-highlight">63</i>&nbsp;
<i class="no-highlight">64</i>&nbsp;        /* Range match - Types are compatible, but differ in range; the argument
<i class="no-highlight">65</i>&nbsp;         * has a smaller range than the parameter. No cast is required.
<i class="no-highlight">66</i>&nbsp;         * e.g., passing a float to foo(double x)
<i class="no-highlight">67</i>&nbsp;         *       passing an int to foo(float x)
<i class="no-highlight">68</i>&nbsp;         *       passing an int to foo(long x)
<i class="no-highlight">69</i>&nbsp;         */
<b class="nc"><i class="no-highlight">70</i>&nbsp;        RANGE_MATCH,</b>
<i class="no-highlight">71</i>&nbsp;
<i class="no-highlight">72</i>&nbsp;        /* Cast Range match - Types are closely compatible, but the argument
<i class="no-highlight">73</i>&nbsp;         * has a much bigger range than the parameter. A cast is necessary to
<i class="no-highlight">74</i>&nbsp;         * make the argument fit into the value. This is needed because Python&#39;s
<i class="no-highlight">75</i>&nbsp;         * internal types use the largest available range types, but Java APIs
<i class="no-highlight">76</i>&nbsp;         * will internally tend to int/float.
<i class="no-highlight">77</i>&nbsp;         * e.g., passing a double to foo(float x)
<i class="no-highlight">78</i>&nbsp;         *       passing a long to foo(int x)
<i class="no-highlight">79</i>&nbsp;         */
<b class="nc"><i class="no-highlight">80</i>&nbsp;        CAST_RANGE_MATCH,</b>
<i class="no-highlight">81</i>&nbsp;
<i class="no-highlight">82</i>&nbsp;        /* Subtype match - Argument is a subtype of the parameter type. No cast
<i class="no-highlight">83</i>&nbsp;         * is required, but an exact match would be preferred.
<i class="no-highlight">84</i>&nbsp;         * e.g., passing a java.lang.String to foo(java.lang.CharSequence x)
<i class="no-highlight">85</i>&nbsp;         */
<b class="nc"><i class="no-highlight">86</i>&nbsp;        SUBTYPE_MATCH,</b>
<i class="no-highlight">87</i>&nbsp;
<i class="no-highlight">88</i>&nbsp;        /* Exact match - types are identical */
<b class="nc"><i class="no-highlight">89</i>&nbsp;        EXACT_MATCH;</b>
<i class="no-highlight">90</i>&nbsp;
<i class="no-highlight">91</i>&nbsp;        public boolean betterThan(MatchType other) {
<b class="nc"><i class="no-highlight">92</i>&nbsp;            return this.compareTo(other) &gt; 0;</b>
<i class="no-highlight">93</i>&nbsp;        }
<i class="no-highlight">94</i>&nbsp;    }
<i class="no-highlight">95</i>&nbsp;
<i class="no-highlight">96</i>&nbsp;    /**
<i class="no-highlight">97</i>&nbsp;     * Determine if a variable of one type can assigned to another type, using
<i class="no-highlight">98</i>&nbsp;     * the definition provided by the Java Language Specification (plus some
<i class="no-highlight">99</i>&nbsp;     * light interpretation from Python usage)
<i class="no-highlight">100</i>&nbsp;     *
<i class="no-highlight">101</i>&nbsp;     * Returns a boolean describing if a variable of type `from_type` can be
<i class="no-highlight">102</i>&nbsp;     * assigned to `to_type`. This will return true if:
<i class="no-highlight">103</i>&nbsp;     *  - `from_type` and `to_type` are the same type
<i class="no-highlight">104</i>&nbsp;     *  - `from_type` is more specific than `to_type`
<i class="no-highlight">105</i>&nbsp;     *  - `from_type and `to_type` are primitives, and `from_type` can be cast to
<i class="no-highlight">106</i>&nbsp;     *    `to_type`, and the `allow_cast` argument is set to true.
<i class="no-highlight">107</i>&nbsp;     */
<i class="no-highlight">108</i>&nbsp;    public static MatchType parameterMatch(java.lang.Class&lt;?&gt; from_type, java.lang.Class&lt;?&gt; to_type) {
<i class="no-highlight">109</i>&nbsp;        // org.Python.debug(&quot;param match: From&quot;, from_type);
<i class="no-highlight">110</i>&nbsp;        // org.Python.debug(&quot;               To&quot;, to_type);
<i class="no-highlight">111</i>&nbsp;
<b class="nc"><i class="no-highlight">112</i>&nbsp;        if (from_type == null) {</b>
<b class="nc"><i class="no-highlight">113</i>&nbsp;            if (to_type == java.lang.Double.TYPE</b>
<i class="no-highlight">114</i>&nbsp;                    || to_type == java.lang.Float.TYPE
<i class="no-highlight">115</i>&nbsp;                    || to_type == java.lang.Long.TYPE
<i class="no-highlight">116</i>&nbsp;                    || to_type == java.lang.Integer.TYPE
<i class="no-highlight">117</i>&nbsp;                    || to_type == java.lang.Short.TYPE
<i class="no-highlight">118</i>&nbsp;                    || to_type == java.lang.Byte.TYPE
<i class="no-highlight">119</i>&nbsp;                    || to_type == java.lang.Character.TYPE) {
<i class="no-highlight">120</i>&nbsp;                // org.Python.debug(&quot;null cannot be assigned to a primitive&quot;);
<b class="nc"><i class="no-highlight">121</i>&nbsp;                return MatchType.NO_MATCH;</b>
<i class="no-highlight">122</i>&nbsp;            } else {
<i class="no-highlight">123</i>&nbsp;                // org.Python.debug(&quot;null can be assigned to any non-primitive&quot;);
<b class="nc"><i class="no-highlight">124</i>&nbsp;                return MatchType.EXACT_MATCH;</b>
<i class="no-highlight">125</i>&nbsp;            }
<i class="no-highlight">126</i>&nbsp;        }
<i class="no-highlight">127</i>&nbsp;
<i class="no-highlight">128</i>&nbsp;        // Check if the two types are the same
<b class="nc"><i class="no-highlight">129</i>&nbsp;        if (to_type.equals(from_type)) {</b>
<i class="no-highlight">130</i>&nbsp;            // org.Python.debug(&quot;from and to are same type&quot;);
<b class="nc"><i class="no-highlight">131</i>&nbsp;            return MatchType.EXACT_MATCH;</b>
<i class="no-highlight">132</i>&nbsp;        }
<i class="no-highlight">133</i>&nbsp;
<i class="no-highlight">134</i>&nbsp;        // Check basic subtyping and assignability
<b class="nc"><i class="no-highlight">135</i>&nbsp;        if (to_type.isAssignableFrom(from_type)) {</b>
<i class="no-highlight">136</i>&nbsp;            // org.Python.debug(java.lang.String.format(&quot;%s arg can be assigned directly&quot;, from_type), to_type);
<b class="nc"><i class="no-highlight">137</i>&nbsp;            return MatchType.SUBTYPE_MATCH;</b>
<i class="no-highlight">138</i>&nbsp;        }
<i class="no-highlight">139</i>&nbsp;
<i class="no-highlight">140</i>&nbsp;        // Then check all the upcasting possible with primitive types
<b class="nc"><i class="no-highlight">141</i>&nbsp;        if (to_type == java.lang.Double.TYPE || to_type == java.lang.Double.class) {</b>
<i class="no-highlight">142</i>&nbsp;            // org.Python.debug(&quot;Parameter needs a double&quot;);
<b class="nc"><i class="no-highlight">143</i>&nbsp;            if (from_type == java.lang.Double.TYPE || from_type == java.lang.Double.class) {</b>
<i class="no-highlight">144</i>&nbsp;                // org.Python.debug(&quot;Got a double&quot;);
<b class="nc"><i class="no-highlight">145</i>&nbsp;                return MatchType.EXACT_MATCH;</b>
<b class="nc"><i class="no-highlight">146</i>&nbsp;            } else if ((from_type == java.lang.Float.TYPE || from_type == java.lang.Float.class)</b>
<i class="no-highlight">147</i>&nbsp;                    || (from_type == java.lang.Long.TYPE || from_type == java.lang.Long.class)
<i class="no-highlight">148</i>&nbsp;                    || (from_type == java.lang.Integer.TYPE || from_type == java.lang.Integer.class)
<i class="no-highlight">149</i>&nbsp;                    || (from_type == java.lang.Short.TYPE || from_type == java.lang.Short.class)
<i class="no-highlight">150</i>&nbsp;                    || (from_type == java.lang.Byte.TYPE || from_type == java.lang.Byte.class)
<i class="no-highlight">151</i>&nbsp;                    || (from_type == java.lang.Character.TYPE || from_type == java.lang.Character.class)) {
<i class="no-highlight">152</i>&nbsp;                // Any number can be assigned to a double.
<i class="no-highlight">153</i>&nbsp;                // org.Python.debug(&quot;Can be assigned directly&quot;);
<b class="nc"><i class="no-highlight">154</i>&nbsp;                return MatchType.RANGE_MATCH;</b>
<i class="no-highlight">155</i>&nbsp;            }
<b class="nc"><i class="no-highlight">156</i>&nbsp;        } else if (to_type == java.lang.Float.TYPE || to_type == java.lang.Float.class) {</b>
<i class="no-highlight">157</i>&nbsp;            // org.Python.debug(&quot;Parameter needs a float&quot;);
<b class="nc"><i class="no-highlight">158</i>&nbsp;            if (from_type == java.lang.Float.TYPE || from_type == java.lang.Float.class) {</b>
<i class="no-highlight">159</i>&nbsp;                // org.Python.debug(&quot;Got a float&quot;);
<b class="nc"><i class="no-highlight">160</i>&nbsp;                return MatchType.EXACT_MATCH;</b>
<b class="nc"><i class="no-highlight">161</i>&nbsp;            } else if (from_type == java.lang.Double.TYPE || from_type == java.lang.Double.class) {</b>
<i class="no-highlight">162</i>&nbsp;                // org.Python.debug(&quot;Got a double&quot;);
<b class="nc"><i class="no-highlight">163</i>&nbsp;                return MatchType.CAST_RANGE_MATCH;</b>
<b class="nc"><i class="no-highlight">164</i>&nbsp;            } else if ((from_type == java.lang.Long.TYPE || from_type == java.lang.Long.class)</b>
<i class="no-highlight">165</i>&nbsp;                    || (from_type == java.lang.Integer.TYPE || from_type == java.lang.Integer.class)
<i class="no-highlight">166</i>&nbsp;                    || (from_type == java.lang.Short.TYPE || from_type == java.lang.Short.class)
<i class="no-highlight">167</i>&nbsp;                    || (from_type == java.lang.Byte.TYPE || from_type == java.lang.Byte.class)
<i class="no-highlight">168</i>&nbsp;                    || (from_type == java.lang.Character.TYPE || from_type == java.lang.Character.class)) {
<i class="no-highlight">169</i>&nbsp;                // org.Python.debug(&quot;Can be assigned directly&quot;);
<b class="nc"><i class="no-highlight">170</i>&nbsp;                return MatchType.RANGE_MATCH;</b>
<i class="no-highlight">171</i>&nbsp;            }
<b class="nc"><i class="no-highlight">172</i>&nbsp;        } else if (to_type == java.lang.Long.TYPE || to_type == java.lang.Long.class) {</b>
<i class="no-highlight">173</i>&nbsp;            // org.Python.debug(&quot;Parameter needs a long&quot;);
<b class="nc"><i class="no-highlight">174</i>&nbsp;            if (from_type == java.lang.Long.TYPE || from_type == java.lang.Long.class) {</b>
<i class="no-highlight">175</i>&nbsp;                // org.Python.debug(&quot;Got a long&quot;);
<b class="nc"><i class="no-highlight">176</i>&nbsp;                return MatchType.EXACT_MATCH;</b>
<b class="nc"><i class="no-highlight">177</i>&nbsp;            } else if ((from_type == java.lang.Double.TYPE || from_type == java.lang.Double.class)</b>
<i class="no-highlight">178</i>&nbsp;                    || (from_type == java.lang.Float.TYPE || from_type == java.lang.Float.class)) {
<i class="no-highlight">179</i>&nbsp;                // org.Python.debug(&quot;Got a double/float&quot;);
<b class="nc"><i class="no-highlight">180</i>&nbsp;                return MatchType.LOOSE_CAST_MATCH;</b>
<b class="nc"><i class="no-highlight">181</i>&nbsp;            } else if ((from_type == java.lang.Integer.TYPE || from_type == java.lang.Integer.class)</b>
<i class="no-highlight">182</i>&nbsp;                    || (from_type == java.lang.Short.TYPE || from_type == java.lang.Short.class)
<i class="no-highlight">183</i>&nbsp;                    || (from_type == java.lang.Byte.TYPE || from_type == java.lang.Byte.class)
<i class="no-highlight">184</i>&nbsp;                    || (from_type == java.lang.Character.TYPE || from_type == java.lang.Character.class)) {
<i class="no-highlight">185</i>&nbsp;                // org.Python.debug(&quot;Can be assigned directly&quot;);
<b class="nc"><i class="no-highlight">186</i>&nbsp;                return MatchType.RANGE_MATCH;</b>
<i class="no-highlight">187</i>&nbsp;            }
<b class="nc"><i class="no-highlight">188</i>&nbsp;        } else if (to_type == java.lang.Integer.TYPE || to_type == java.lang.Integer.class) {</b>
<i class="no-highlight">189</i>&nbsp;            // org.Python.debug(&quot;Parameter needs a integer&quot;);
<b class="nc"><i class="no-highlight">190</i>&nbsp;            if (from_type == java.lang.Integer.TYPE || from_type == java.lang.Integer.class) {</b>
<i class="no-highlight">191</i>&nbsp;                // org.Python.debug(&quot;Got an int&quot;);
<b class="nc"><i class="no-highlight">192</i>&nbsp;                return MatchType.EXACT_MATCH;</b>
<b class="nc"><i class="no-highlight">193</i>&nbsp;            } else if ((from_type == java.lang.Double.TYPE || from_type == java.lang.Double.class)</b>
<i class="no-highlight">194</i>&nbsp;                    || (from_type == java.lang.Float.TYPE || from_type == java.lang.Float.class)) {
<i class="no-highlight">195</i>&nbsp;                // org.Python.debug(&quot;Got a double/float&quot;);
<b class="nc"><i class="no-highlight">196</i>&nbsp;                return MatchType.LOOSE_CAST_MATCH;</b>
<b class="nc"><i class="no-highlight">197</i>&nbsp;            } else if (from_type == java.lang.Long.TYPE || from_type == java.lang.Long.class) {</b>
<i class="no-highlight">198</i>&nbsp;                // org.Python.debug(&quot;Got a long&quot;);
<b class="nc"><i class="no-highlight">199</i>&nbsp;                return MatchType.CAST_RANGE_MATCH;</b>
<b class="nc"><i class="no-highlight">200</i>&nbsp;            } else if ((from_type == java.lang.Short.TYPE || from_type == java.lang.Short.class)</b>
<i class="no-highlight">201</i>&nbsp;                    || (from_type == java.lang.Byte.TYPE || from_type == java.lang.Byte.class)
<i class="no-highlight">202</i>&nbsp;                    || (from_type == java.lang.Character.TYPE || from_type == java.lang.Character.class)) {
<i class="no-highlight">203</i>&nbsp;                // org.Python.debug(&quot;Can be assigned directly&quot;);
<b class="nc"><i class="no-highlight">204</i>&nbsp;                return MatchType.RANGE_MATCH;</b>
<i class="no-highlight">205</i>&nbsp;            }
<b class="nc"><i class="no-highlight">206</i>&nbsp;        } else if (to_type == java.lang.Short.TYPE || to_type == java.lang.Short.class) {</b>
<i class="no-highlight">207</i>&nbsp;            // org.Python.debug(&quot;Parameter needs a short&quot;);
<b class="nc"><i class="no-highlight">208</i>&nbsp;            if (from_type == java.lang.Short.TYPE || from_type == java.lang.Short.class) {</b>
<i class="no-highlight">209</i>&nbsp;                // org.Python.debug(&quot;Got a short&quot;);
<b class="nc"><i class="no-highlight">210</i>&nbsp;                return MatchType.EXACT_MATCH;</b>
<b class="nc"><i class="no-highlight">211</i>&nbsp;            } else if ((from_type == java.lang.Double.TYPE || from_type == java.lang.Double.class)</b>
<i class="no-highlight">212</i>&nbsp;                    || (from_type == java.lang.Float.TYPE || from_type == java.lang.Float.class)) {
<i class="no-highlight">213</i>&nbsp;                // org.Python.debug(&quot;Got a double/float&quot;);
<b class="nc"><i class="no-highlight">214</i>&nbsp;                return MatchType.LOOSE_CAST_MATCH;</b>
<b class="nc"><i class="no-highlight">215</i>&nbsp;            } else if ((from_type == java.lang.Long.TYPE || from_type == java.lang.Long.class)</b>
<i class="no-highlight">216</i>&nbsp;                    || (from_type == java.lang.Integer.TYPE || from_type == java.lang.Integer.class)) {
<i class="no-highlight">217</i>&nbsp;                // org.Python.debug(&quot;Got a long/int&quot;);
<b class="nc"><i class="no-highlight">218</i>&nbsp;                return MatchType.CAST_RANGE_MATCH;</b>
<b class="nc"><i class="no-highlight">219</i>&nbsp;            } else if ((from_type == java.lang.Byte.TYPE || from_type == java.lang.Byte.class)</b>
<i class="no-highlight">220</i>&nbsp;                    || (from_type == java.lang.Character.TYPE || from_type == java.lang.Character.class)) {
<i class="no-highlight">221</i>&nbsp;                // org.Python.debug(&quot;Can be assigned directly&quot;);
<b class="nc"><i class="no-highlight">222</i>&nbsp;                return MatchType.RANGE_MATCH;</b>
<i class="no-highlight">223</i>&nbsp;            }
<b class="nc"><i class="no-highlight">224</i>&nbsp;        } else if (to_type == java.lang.Character.TYPE || to_type == java.lang.Character.class) {</b>
<i class="no-highlight">225</i>&nbsp;            // org.Python.debug(&quot;Parameter needs a char&quot;);
<b class="nc"><i class="no-highlight">226</i>&nbsp;            if (from_type == java.lang.Character.TYPE || from_type == java.lang.Character.class) {</b>
<i class="no-highlight">227</i>&nbsp;                // org.Python.debug(&quot;Got a char&quot;);
<b class="nc"><i class="no-highlight">228</i>&nbsp;                return MatchType.EXACT_MATCH;</b>
<b class="nc"><i class="no-highlight">229</i>&nbsp;            } else if ((from_type == java.lang.Long.TYPE || from_type == java.lang.Long.class)</b>
<i class="no-highlight">230</i>&nbsp;                    || (from_type == java.lang.Integer.TYPE || from_type == java.lang.Integer.class)
<i class="no-highlight">231</i>&nbsp;                    || (from_type == java.lang.Short.TYPE || from_type == java.lang.Short.class)) {
<i class="no-highlight">232</i>&nbsp;                // org.Python.debug(&quot;Got a long/int/short&quot;);
<b class="nc"><i class="no-highlight">233</i>&nbsp;                return MatchType.CAST_RANGE_MATCH;</b>
<b class="nc"><i class="no-highlight">234</i>&nbsp;            } else if (from_type == java.lang.Byte.TYPE || from_type == java.lang.Byte.class) {</b>
<i class="no-highlight">235</i>&nbsp;                // org.Python.debug(&quot;Can be assigned directly&quot;);
<b class="nc"><i class="no-highlight">236</i>&nbsp;                return MatchType.RANGE_MATCH;</b>
<i class="no-highlight">237</i>&nbsp;            }
<b class="nc"><i class="no-highlight">238</i>&nbsp;        } else if (to_type == java.lang.Byte.TYPE || to_type == java.lang.Byte.class) {</b>
<i class="no-highlight">239</i>&nbsp;            // org.Python.debug(&quot;Parameter needs a byte&quot;);
<b class="nc"><i class="no-highlight">240</i>&nbsp;            if (from_type == java.lang.Byte.TYPE || from_type == java.lang.Byte.class) {</b>
<i class="no-highlight">241</i>&nbsp;                // org.Python.debug(&quot;Got a byte&quot;);
<b class="nc"><i class="no-highlight">242</i>&nbsp;                return MatchType.EXACT_MATCH;</b>
<b class="nc"><i class="no-highlight">243</i>&nbsp;            } else if ((from_type == java.lang.Long.TYPE || from_type == java.lang.Long.class)</b>
<i class="no-highlight">244</i>&nbsp;                    || (from_type == java.lang.Integer.TYPE || from_type == java.lang.Integer.class)
<i class="no-highlight">245</i>&nbsp;                    || (from_type == java.lang.Short.TYPE || from_type == java.lang.Short.class)
<i class="no-highlight">246</i>&nbsp;                    || (from_type == java.lang.Character.TYPE || from_type == java.lang.Character.class)) {
<i class="no-highlight">247</i>&nbsp;                // org.Python.debug(&quot;Got a long/int/short/char&quot;);
<b class="nc"><i class="no-highlight">248</i>&nbsp;                return MatchType.CAST_RANGE_MATCH;</b>
<i class="no-highlight">249</i>&nbsp;            }
<i class="no-highlight">250</i>&nbsp;            // } else {
<i class="no-highlight">251</i>&nbsp;            //     org.Python.debug(&quot;Don&#39;t know what to do with to-type&quot;, to_type);
<i class="no-highlight">252</i>&nbsp;        }
<i class="no-highlight">253</i>&nbsp;
<i class="no-highlight">254</i>&nbsp;        // org.Python.debug(&quot;Can&#39;t be assigned&quot;);
<b class="nc"><i class="no-highlight">255</i>&nbsp;        return MatchType.NO_MATCH;</b>
<i class="no-highlight">256</i>&nbsp;    }
<i class="no-highlight">257</i>&nbsp;
<i class="no-highlight">258</i>&nbsp;    /**
<i class="no-highlight">259</i>&nbsp;     * Given a list of methods (with signatures), and a set of args and kwargs, find
<i class="no-highlight">260</i>&nbsp;     * the method that is the best match for the args and kwargs, following the rules
<i class="no-highlight">261</i>&nbsp;     * of the Java Language Specification.
<i class="no-highlight">262</i>&nbsp;     *
<i class="no-highlight">263</i>&nbsp;     * Returns null if no method match can be found.
<i class="no-highlight">264</i>&nbsp;     *
<i class="no-highlight">265</i>&nbsp;     * If multiple matches exist return the most specific match.
<i class="no-highlight">266</i>&nbsp;     */
<i class="no-highlight">267</i>&nbsp;    public java.lang.reflect.Method selectMethod(org.python.Object[] args, java.util.Map&lt;java.lang.String, org.python.Object&gt; kwargs) {
<i class="no-highlight">268</i>&nbsp;        // org.Python.debug(&quot;Method options: &quot;, this.methods);
<b class="nc"><i class="no-highlight">269</i>&nbsp;        int n_args = (args == null) ? 0 : args.length;</b>
<b class="nc"><i class="no-highlight">270</i>&nbsp;        java.lang.reflect.Method method = null;</b>
<b class="nc"><i class="no-highlight">271</i>&nbsp;        java.lang.StringBuilder signature = new java.lang.StringBuilder();</b>
<b class="nc"><i class="no-highlight">272</i>&nbsp;        java.lang.Class&lt;?&gt;[] arg_types = null;</b>
<b class="nc"><i class="no-highlight">273</i>&nbsp;        if (n_args != 0) {</b>
<b class="nc"><i class="no-highlight">274</i>&nbsp;            arg_types = new java.lang.Class&lt;?&gt;[n_args];</b>
<b class="nc"><i class="no-highlight">275</i>&nbsp;            for (int i = 0; i &lt; n_args; i++) {</b>
<b class="nc"><i class="no-highlight">276</i>&nbsp;                if (args[i] == null) {</b>
<b class="nc"><i class="no-highlight">277</i>&nbsp;                    arg_types[i] = null;</b>
<b class="nc"><i class="no-highlight">278</i>&nbsp;                } else if (args[i].toJava() == null) {</b>
<b class="nc"><i class="no-highlight">279</i>&nbsp;                    arg_types[i] = null;</b>
<i class="no-highlight">280</i>&nbsp;                } else {
<b class="nc"><i class="no-highlight">281</i>&nbsp;                    arg_types[i] = args[i].toJava().getClass();</b>
<i class="no-highlight">282</i>&nbsp;                }
<b class="nc"><i class="no-highlight">283</i>&nbsp;                signature.append(Function.descriptor(arg_types[i]));</b>
<i class="no-highlight">284</i>&nbsp;            }
<i class="no-highlight">285</i>&nbsp;        }
<i class="no-highlight">286</i>&nbsp;
<i class="no-highlight">287</i>&nbsp;        // org.Python.debug(&quot;Argument signature&quot;, signature);
<b class="nc"><i class="no-highlight">288</i>&nbsp;        method = this.methods.get(signature.toString());</b>
<i class="no-highlight">289</i>&nbsp;
<i class="no-highlight">290</i>&nbsp;        // No pre-cached match - need to try alternatives for signature.
<b class="nc"><i class="no-highlight">291</i>&nbsp;        if (method == null) {</b>
<b class="nc"><i class="no-highlight">292</i>&nbsp;            java.util.List&lt;java.lang.reflect.Method&gt; candidates = new java.util.ArrayList&lt;java.lang.reflect.Method&gt;();</b>
<b class="nc"><i class="no-highlight">293</i>&nbsp;            java.lang.Class&lt;?&gt;[] param_types = null;</b>
<b class="nc"><i class="no-highlight">294</i>&nbsp;            Function.MatchType param_match = Function.MatchType.EXACT_MATCH;</b>
<i class="no-highlight">295</i>&nbsp;
<b class="nc"><i class="no-highlight">296</i>&nbsp;            for (java.lang.reflect.Method candidate : this.methods.values()) {</b>
<b class="nc"><i class="no-highlight">297</i>&nbsp;                param_types = candidate.getParameterTypes();</b>
<i class="no-highlight">298</i>&nbsp;
<i class="no-highlight">299</i>&nbsp;                // Candidate must have the same number of parameters as
<i class="no-highlight">300</i>&nbsp;                // there are arguments.
<b class="nc"><i class="no-highlight">301</i>&nbsp;                if (param_types.length == n_args) {</b>
<i class="no-highlight">302</i>&nbsp;
<i class="no-highlight">303</i>&nbsp;                    // Check each parameter; the argument must be a
<i class="no-highlight">304</i>&nbsp;                    // subclass of the parameter type.
<b class="nc"><i class="no-highlight">305</i>&nbsp;                    boolean match = true;</b>
<b class="nc"><i class="no-highlight">306</i>&nbsp;                    for (int i = 0; i &lt; n_args; i++) {</b>
<b class="nc"><i class="no-highlight">307</i>&nbsp;                        if (Function.parameterMatch(arg_types[i], param_types[i]) == Function.MatchType.NO_MATCH) {</b>
<b class="nc"><i class="no-highlight">308</i>&nbsp;                            match = false;</b>
<i class="no-highlight">309</i>&nbsp;                        }
<i class="no-highlight">310</i>&nbsp;                    }
<i class="no-highlight">311</i>&nbsp;
<b class="nc"><i class="no-highlight">312</i>&nbsp;                    if (match) {</b>
<i class="no-highlight">313</i>&nbsp;                        // org.Python.debug(&quot;New candidate&quot;, candidate);
<b class="nc"><i class="no-highlight">314</i>&nbsp;                        candidates.add(candidate);</b>
<i class="no-highlight">315</i>&nbsp;                        // } else {
<i class="no-highlight">316</i>&nbsp;                        //     org.Python.debug(&quot;Ignore candidate; non-matching signature&quot;, candidate);
<i class="no-highlight">317</i>&nbsp;                    }
<i class="no-highlight">318</i>&nbsp;                    // } else {
<i class="no-highlight">319</i>&nbsp;                    //     org.Python.debug(&quot;Ignore candidate; wrong number of parameters&quot;, candidate);
<i class="no-highlight">320</i>&nbsp;                }
<b class="nc"><i class="no-highlight">321</i>&nbsp;            }</b>
<i class="no-highlight">322</i>&nbsp;
<i class="no-highlight">323</i>&nbsp;            // Now work out *which* candidate is the most specific match.
<i class="no-highlight">324</i>&nbsp;            java.lang.Class&lt;?&gt;[] candidate_types;
<i class="no-highlight">325</i>&nbsp;            Function.MatchType candidate_match;
<i class="no-highlight">326</i>&nbsp;            // org.Python.debug(&quot;Choose best candidate...&quot;, candidates);
<b class="nc"><i class="no-highlight">327</i>&nbsp;            for (java.lang.reflect.Method candidate : candidates) {</b>
<i class="no-highlight">328</i>&nbsp;                // org.Python.debug(&quot;Evaluate candidate&quot;, candidate);
<b class="nc"><i class="no-highlight">329</i>&nbsp;                if (method == null) {</b>
<i class="no-highlight">330</i>&nbsp;                    // org.Python.debug(&quot;New best (default) candidate&quot;, candidate);
<b class="nc"><i class="no-highlight">331</i>&nbsp;                    method = candidate;</b>
<b class="nc"><i class="no-highlight">332</i>&nbsp;                    param_types = candidate.getParameterTypes();</b>
<b class="nc"><i class="no-highlight">333</i>&nbsp;                    for (int i = 0; i &lt; n_args; i++) {</b>
<b class="nc"><i class="no-highlight">334</i>&nbsp;                        candidate_match = Function.parameterMatch(arg_types[i], param_types[i]);</b>
<i class="no-highlight">335</i>&nbsp;                        // org.Python.debug(java.lang.String.format(&quot;Parameter %d has match&quot;, i), candidate_match);
<b class="nc"><i class="no-highlight">336</i>&nbsp;                        if (param_match.betterThan(candidate_match)) {</b>
<b class="nc"><i class="no-highlight">337</i>&nbsp;                            param_match = candidate_match;</b>
<i class="no-highlight">338</i>&nbsp;                        }
<i class="no-highlight">339</i>&nbsp;                    }
<i class="no-highlight">340</i>&nbsp;                    // org.Python.debug(&quot;Candidate match:&quot;, param_match);
<i class="no-highlight">341</i>&nbsp;                } else {
<b class="nc"><i class="no-highlight">342</i>&nbsp;                    candidate_types = candidate.getParameterTypes();</b>
<b class="nc"><i class="no-highlight">343</i>&nbsp;                    candidate_match = Function.MatchType.EXACT_MATCH;</b>
<i class="no-highlight">344</i>&nbsp;                    Function.MatchType match;
<b class="nc"><i class="no-highlight">345</i>&nbsp;                    for (int i = 0; i &lt; n_args; i++) {</b>
<b class="nc"><i class="no-highlight">346</i>&nbsp;                        match = Function.parameterMatch(arg_types[i], candidate_types[i]);</b>
<i class="no-highlight">347</i>&nbsp;                        // org.Python.debug(java.lang.String.format(&quot;Parameter %d has match&quot;, i), match);
<b class="nc"><i class="no-highlight">348</i>&nbsp;                        if (candidate_match.betterThan(match)) {</b>
<b class="nc"><i class="no-highlight">349</i>&nbsp;                            candidate_match = match;</b>
<i class="no-highlight">350</i>&nbsp;                        }
<i class="no-highlight">351</i>&nbsp;                    }
<i class="no-highlight">352</i>&nbsp;                    // org.Python.debug(&quot;Candidate match:&quot;, candidate_match);
<i class="no-highlight">353</i>&nbsp;
<b class="nc"><i class="no-highlight">354</i>&nbsp;                    if (candidate_match.betterThan(param_match)) {</b>
<i class="no-highlight">355</i>&nbsp;                        // org.Python.debug(&quot;New best candidate&quot;, candidate);
<b class="nc"><i class="no-highlight">356</i>&nbsp;                        method = candidate;</b>
<b class="nc"><i class="no-highlight">357</i>&nbsp;                        param_types = candidate_types;</b>
<b class="nc"><i class="no-highlight">358</i>&nbsp;                        param_match = candidate_match;</b>
<i class="no-highlight">359</i>&nbsp;                    }
<i class="no-highlight">360</i>&nbsp;                }
<b class="nc"><i class="no-highlight">361</i>&nbsp;            }</b>
<i class="no-highlight">362</i>&nbsp;
<i class="no-highlight">363</i>&nbsp;            // If there is still no match, raise an error.
<b class="nc"><i class="no-highlight">364</i>&nbsp;            if (method == null) {</b>
<b class="nc"><i class="no-highlight">365</i>&nbsp;                throw new org.python.exceptions.RuntimeError(</b>
<b class="nc"><i class="no-highlight">366</i>&nbsp;                        java.lang.String.format(</b>
<i class="no-highlight">367</i>&nbsp;                                &quot;No candidate method found for signature %s(%s); tried %s&quot;,
<i class="no-highlight">368</i>&nbsp;                                this.name,
<b class="nc"><i class="no-highlight">369</i>&nbsp;                                signature.toString(),</b>
<i class="no-highlight">370</i>&nbsp;                                candidates
<i class="no-highlight">371</i>&nbsp;                        )
<i class="no-highlight">372</i>&nbsp;                );
<i class="no-highlight">373</i>&nbsp;            }
<i class="no-highlight">374</i>&nbsp;
<i class="no-highlight">375</i>&nbsp;            // We have a match that wasn&#39;t previously in the this.methods dictionary;
<i class="no-highlight">376</i>&nbsp;            // Cache it for later use.
<b class="nc"><i class="no-highlight">377</i>&nbsp;            this.methods.put(signature.toString(), method);</b>
<i class="no-highlight">378</i>&nbsp;        }
<i class="no-highlight">379</i>&nbsp;
<i class="no-highlight">380</i>&nbsp;        // If the method is protected/private, it won&#39;t be invokable.
<i class="no-highlight">381</i>&nbsp;        // Set the method to be accessible;
<b class="nc"><i class="no-highlight">382</i>&nbsp;        method.setAccessible(true);</b>
<b class="nc"><i class="no-highlight">383</i>&nbsp;        return method;</b>
<i class="no-highlight">384</i>&nbsp;    }
<i class="no-highlight">385</i>&nbsp;
<i class="no-highlight">386</i>&nbsp;    public java.lang.Object[] adjustArguments(java.lang.reflect.Method method, org.python.Object[] args, java.util.Map&lt;java.lang.String, org.python.Object&gt; kwargs) {
<b class="nc"><i class="no-highlight">387</i>&nbsp;        java.lang.Object[] adjusted = new java.lang.Object[args.length];</b>
<b class="nc"><i class="no-highlight">388</i>&nbsp;        java.lang.Class&lt;?&gt;[] param_types = method.getParameterTypes();</b>
<b class="nc"><i class="no-highlight">389</i>&nbsp;        for (int i = 0; i &lt; args.length; i++) {</b>
<b class="nc"><i class="no-highlight">390</i>&nbsp;            adjusted[i] = org.python.types.Type.toJava(param_types[i], args[i]);</b>
<i class="no-highlight">391</i>&nbsp;        }
<b class="nc"><i class="no-highlight">392</i>&nbsp;        return adjusted;</b>
<i class="no-highlight">393</i>&nbsp;    }
<i class="no-highlight">394</i>&nbsp;
<i class="no-highlight">395</i>&nbsp;    public Function(java.lang.Class klass, java.lang.String name) {
<b class="nc"><i class="no-highlight">396</i>&nbsp;        super();</b>
<b class="nc"><i class="no-highlight">397</i>&nbsp;        this.klass = klass;</b>
<b class="nc"><i class="no-highlight">398</i>&nbsp;        this.name = name;</b>
<i class="no-highlight">399</i>&nbsp;        // org.Python.debug(&quot;FUNCTION &quot;, this.name);
<b class="nc"><i class="no-highlight">400</i>&nbsp;        this.methods = new java.util.HashMap&lt;java.lang.String, java.lang.reflect.Method&gt;();</b>
<i class="no-highlight">401</i>&nbsp;
<i class="no-highlight">402</i>&nbsp;        // When searching for a function, we search *declared* fields -
<i class="no-highlight">403</i>&nbsp;        // that&#39;s all fields that are acutally defined directly on this
<i class="no-highlight">404</i>&nbsp;        // class. However, having found a match on this class, we then
<i class="no-highlight">405</i>&nbsp;        // search all subclasses as well, in case there is a method
<i class="no-highlight">406</i>&nbsp;        // with the same name, but a different prototype. This simplifies
<i class="no-highlight">407</i>&nbsp;        // the lookup process when the function is invoked.
<b class="nc"><i class="no-highlight">408</i>&nbsp;        java.lang.Class&lt;?&gt; clazz = klass;</b>
<b class="nc"><i class="no-highlight">409</i>&nbsp;        while (clazz != null) {</b>
<i class="no-highlight">410</i>&nbsp;            // org.Python.debug(&quot;CLAZZ:&quot;, clazz);
<b class="nc"><i class="no-highlight">411</i>&nbsp;            for (java.lang.reflect.Method method : clazz.getDeclaredMethods()) {</b>
<i class="no-highlight">412</i>&nbsp;                // org.Python.debug(&quot;METHOD:&quot;, method.getName());
<b class="nc"><i class="no-highlight">413</i>&nbsp;                if (method.getName().equals(name)) {</b>
<b class="nc"><i class="no-highlight">414</i>&nbsp;                    java.lang.StringBuilder signature = new java.lang.StringBuilder();</b>
<i class="no-highlight">415</i>&nbsp;
<b class="nc"><i class="no-highlight">416</i>&nbsp;                    for (java.lang.Class c : method.getParameterTypes()) {</b>
<b class="nc"><i class="no-highlight">417</i>&nbsp;                        signature.append(org.python.java.Function.descriptor(c));</b>
<i class="no-highlight">418</i>&nbsp;                    }
<i class="no-highlight">419</i>&nbsp;
<i class="no-highlight">420</i>&nbsp;                    // org.Python.debug(&quot;  match: &quot;, signature.toString());
<i class="no-highlight">421</i>&nbsp;                    // org.Python.debug(&quot;    known: &quot;, this.methods.containsKey(signature.toString()));
<i class="no-highlight">422</i>&nbsp;                    // org.Python.debug(&quot;    abstract: &quot;, java.lang.reflect.Modifier.isAbstract(method.getModifiers()));
<i class="no-highlight">423</i>&nbsp;
<b class="nc"><i class="no-highlight">424</i>&nbsp;                    java.lang.String sig = signature.toString();</b>
<b class="nc"><i class="no-highlight">425</i>&nbsp;                    boolean is_abstract = java.lang.reflect.Modifier.isAbstract(method.getModifiers());</b>
<b class="nc"><i class="no-highlight">426</i>&nbsp;                    if (!this.methods.containsKey(sig) &amp;&amp; !is_abstract) {</b>
<b class="nc"><i class="no-highlight">427</i>&nbsp;                        this.methods.put(sig, method);</b>
<i class="no-highlight">428</i>&nbsp;                    }
<i class="no-highlight">429</i>&nbsp;                }
<i class="no-highlight">430</i>&nbsp;            }
<i class="no-highlight">431</i>&nbsp;
<i class="no-highlight">432</i>&nbsp;            // If we&#39;ve searched for the name, and and we haven&#39;t found
<i class="no-highlight">433</i>&nbsp;            // any matches, throw an attribute error.
<b class="nc"><i class="no-highlight">434</i>&nbsp;            if (this.methods.size() == 0) {</b>
<b class="nc"><i class="no-highlight">435</i>&nbsp;                throw new org.python.exceptions.AttributeError(klass, name);</b>
<i class="no-highlight">436</i>&nbsp;            }
<i class="no-highlight">437</i>&nbsp;
<b class="nc"><i class="no-highlight">438</i>&nbsp;            clazz = clazz.getSuperclass();</b>
<i class="no-highlight">439</i>&nbsp;        }
<i class="no-highlight">440</i>&nbsp;        // org.Python.debug(&quot;methods: &quot;, this.methods);
<b class="nc"><i class="no-highlight">441</i>&nbsp;        org.python.types.Str n = new org.python.types.Str(this.name);</b>
<b class="nc"><i class="no-highlight">442</i>&nbsp;        this.__dict__.put(&quot;__name__&quot;, n);</b>
<b class="nc"><i class="no-highlight">443</i>&nbsp;        this.__dict__.put(&quot;__qualname__&quot;, n);</b>
<i class="no-highlight">444</i>&nbsp;    }
<i class="no-highlight">445</i>&nbsp;
<i class="no-highlight">446</i>&nbsp;    @org.python.Method(
<i class="no-highlight">447</i>&nbsp;            __doc__ = &quot;Implement repr(self).&quot;
<i class="no-highlight">448</i>&nbsp;    )
<i class="no-highlight">449</i>&nbsp;    public org.python.types.Str __repr__() {
<b class="nc"><i class="no-highlight">450</i>&nbsp;        return new org.python.types.Str(</b>
<b class="nc"><i class="no-highlight">451</i>&nbsp;                java.lang.String.format(&quot;&lt;native function %s.%s&gt;&quot;,</b>
<b class="nc"><i class="no-highlight">452</i>&nbsp;                        this.klass.getName(),</b>
<i class="no-highlight">453</i>&nbsp;                        this.name)
<i class="no-highlight">454</i>&nbsp;        );
<i class="no-highlight">455</i>&nbsp;    }
<i class="no-highlight">456</i>&nbsp;
<i class="no-highlight">457</i>&nbsp;    @org.python.Method(
<i class="no-highlight">458</i>&nbsp;            __doc__ = &quot;Implement __get__(self).&quot;
<i class="no-highlight">459</i>&nbsp;    )
<i class="no-highlight">460</i>&nbsp;    public org.python.Object __get__(org.python.Object instance, org.python.Object klass) {
<b class="nc"><i class="no-highlight">461</i>&nbsp;        if (instance == klass) {</b>
<b class="nc"><i class="no-highlight">462</i>&nbsp;            return this;</b>
<i class="no-highlight">463</i>&nbsp;        } else {
<b class="nc"><i class="no-highlight">464</i>&nbsp;            return new org.python.java.Method(instance, this);</b>
<i class="no-highlight">465</i>&nbsp;        }
<i class="no-highlight">466</i>&nbsp;    }
<i class="no-highlight">467</i>&nbsp;
<i class="no-highlight">468</i>&nbsp;    @org.python.Method(
<i class="no-highlight">469</i>&nbsp;            __doc__ = &quot;&quot;
<i class="no-highlight">470</i>&nbsp;    )
<i class="no-highlight">471</i>&nbsp;    public org.python.Object __bool__() {
<b class="nc"><i class="no-highlight">472</i>&nbsp;        return org.python.types.Bool.TRUE;</b>
<i class="no-highlight">473</i>&nbsp;    }
<i class="no-highlight">474</i>&nbsp;
<i class="no-highlight">475</i>&nbsp;    public org.python.Object invoke(org.python.Object[] args, java.util.Map&lt;java.lang.String, org.python.Object&gt; kwargs) {
<b class="nc"><i class="no-highlight">476</i>&nbsp;        return this.invoke(null, args, kwargs);</b>
<i class="no-highlight">477</i>&nbsp;    }
<i class="no-highlight">478</i>&nbsp;
<i class="no-highlight">479</i>&nbsp;    public org.python.Object invoke(org.python.Object instance, org.python.Object[] args, java.util.Map&lt;java.lang.String, org.python.Object&gt; kwargs) {
<i class="no-highlight">480</i>&nbsp;        try {
<b class="nc"><i class="no-highlight">481</i>&nbsp;            java.lang.Object target = null;</b>
<i class="no-highlight">482</i>&nbsp;            // org.Python.debug(&quot;Native Function:&quot;, this.name);
<i class="no-highlight">483</i>&nbsp;            // org.Python.debug(&quot;       instance: &quot;, instance);
<b class="nc"><i class="no-highlight">484</i>&nbsp;            if (instance != null) {</b>
<b class="nc"><i class="no-highlight">485</i>&nbsp;                target = instance.toObject();</b>
<i class="no-highlight">486</i>&nbsp;                // org.Python.debug(&quot;         target: &quot;, target);
<i class="no-highlight">487</i>&nbsp;            }
<i class="no-highlight">488</i>&nbsp;            // for (org.python.Object arg: args) {
<i class="no-highlight">489</i>&nbsp;            //     org.Python.debug(&quot;            arg: &quot;, arg);
<i class="no-highlight">490</i>&nbsp;            //     if (arg != null) {
<i class="no-highlight">491</i>&nbsp;            //         org.Python.debug(&quot;           type: &quot;, arg.getClass());
<i class="no-highlight">492</i>&nbsp;            //     }
<i class="no-highlight">493</i>&nbsp;            // }
<i class="no-highlight">494</i>&nbsp;            // org.Python.debug(&quot;         kwargs: &quot;, kwargs);
<i class="no-highlight">495</i>&nbsp;
<b class="nc"><i class="no-highlight">496</i>&nbsp;            if (kwargs != null &amp;&amp; kwargs.size() &gt; 0) {</b>
<i class="no-highlight">497</i>&nbsp;                // TODO: This doesn&#39;t have to be so - we *could* introspect argument names.
<b class="nc"><i class="no-highlight">498</i>&nbsp;                throw new org.python.exceptions.RuntimeError(&quot;Cannot use kwargs to invoke a native Java method.&quot;);</b>
<i class="no-highlight">499</i>&nbsp;            }
<i class="no-highlight">500</i>&nbsp;
<b class="nc"><i class="no-highlight">501</i>&nbsp;            java.lang.reflect.Method method = this.selectMethod(args, kwargs);</b>
<i class="no-highlight">502</i>&nbsp;
<i class="no-highlight">503</i>&nbsp;            // org.Python.debug(&quot;  Native method: &quot;, method);
<b class="nc"><i class="no-highlight">504</i>&nbsp;            java.lang.Object[] adjusted_args = null;</b>
<b class="nc"><i class="no-highlight">505</i>&nbsp;            if (args != null || kwargs != null) {</b>
<b class="nc"><i class="no-highlight">506</i>&nbsp;                adjusted_args = this.adjustArguments(method, args, kwargs);</b>
<i class="no-highlight">507</i>&nbsp;            }
<i class="no-highlight">508</i>&nbsp;
<i class="no-highlight">509</i>&nbsp;            // if (adjusted_args != null) {
<i class="no-highlight">510</i>&nbsp;            //     for (java.lang.Object arg: adjusted_args) {
<i class="no-highlight">511</i>&nbsp;            //         org.Python.debug(&quot;   Adjusted arg: &quot;, arg);
<i class="no-highlight">512</i>&nbsp;            //         if (arg != null) {
<i class="no-highlight">513</i>&nbsp;            //             org.Python.debug(&quot;           type: &quot;, arg.getClass());
<i class="no-highlight">514</i>&nbsp;            //         }
<i class="no-highlight">515</i>&nbsp;            //     }
<i class="no-highlight">516</i>&nbsp;            // } else {
<i class="no-highlight">517</i>&nbsp;            //     org.Python.debug(&quot;No adjusted args&quot;);
<i class="no-highlight">518</i>&nbsp;            // }
<i class="no-highlight">519</i>&nbsp;
<b class="nc"><i class="no-highlight">520</i>&nbsp;            java.lang.Object result = method.invoke(target, adjusted_args);</b>
<i class="no-highlight">521</i>&nbsp;            // org.Python.debug(&quot;NATIVE RESULT&quot;, result);
<i class="no-highlight">522</i>&nbsp;
<b class="nc"><i class="no-highlight">523</i>&nbsp;            org.python.Object pyresult = org.python.types.Type.toPython(result);</b>
<i class="no-highlight">524</i>&nbsp;            // org.Python.debug(&quot;PYTHON RESULT&quot;, pyresult);
<i class="no-highlight">525</i>&nbsp;            // if (pyresult != null) {
<i class="no-highlight">526</i>&nbsp;            //     org.Python.debug(&quot;PYTHON RESULT CLASS&quot;, pyresult.getClass());
<i class="no-highlight">527</i>&nbsp;            //     org.Python.debug(&quot;PYTHON RESULT TOJAVA&quot;, pyresult.toJava());
<i class="no-highlight">528</i>&nbsp;            //     if (pyresult.toJava() != null) {
<i class="no-highlight">529</i>&nbsp;            //         org.Python.debug(&quot;PYTHON RESULT TOJAVA&quot;, pyresult.toJava().getClass());
<i class="no-highlight">530</i>&nbsp;            //     }
<i class="no-highlight">531</i>&nbsp;            // }
<b class="nc"><i class="no-highlight">532</i>&nbsp;            return pyresult;</b>
<b class="nc"><i class="no-highlight">533</i>&nbsp;        } catch (java.lang.IllegalAccessException iae) {</b>
<b class="nc"><i class="no-highlight">534</i>&nbsp;            throw new org.python.exceptions.RuntimeError(iae.toString());</b>
<b class="nc"><i class="no-highlight">535</i>&nbsp;        } catch (java.lang.reflect.InvocationTargetException e) {</b>
<i class="no-highlight">536</i>&nbsp;            try {
<i class="no-highlight">537</i>&nbsp;                // org.Python.debug(&quot;Exception:&quot;, e.getTargetException());
<i class="no-highlight">538</i>&nbsp;                // for (java.lang.StackTraceElement ste: e.getTargetException().getStackTrace()) {
<i class="no-highlight">539</i>&nbsp;                //     org.Python.debug(&quot;     &quot;, ste);
<i class="no-highlight">540</i>&nbsp;                // }
<i class="no-highlight">541</i>&nbsp;                // If the Java method raised an Python exception, re-raise that
<i class="no-highlight">542</i>&nbsp;                // exception as-is. If it wasn&quot;t a Python exception, wrap it
<i class="no-highlight">543</i>&nbsp;                // as one and continue.
<b class="nc"><i class="no-highlight">544</i>&nbsp;                throw (org.python.exceptions.BaseException) e.getCause();</b>
<b class="nc"><i class="no-highlight">545</i>&nbsp;            } catch (ClassCastException java_e) {</b>
<b class="nc"><i class="no-highlight">546</i>&nbsp;                java.lang.String message = e.getCause().getMessage();</b>
<b class="nc"><i class="no-highlight">547</i>&nbsp;                if (message == null) {</b>
<b class="nc"><i class="no-highlight">548</i>&nbsp;                    throw new org.python.exceptions.RuntimeError(</b>
<b class="nc"><i class="no-highlight">549</i>&nbsp;                            e.getCause().getClass().getName()</b>
<i class="no-highlight">550</i>&nbsp;                    );
<i class="no-highlight">551</i>&nbsp;                } else {
<b class="nc"><i class="no-highlight">552</i>&nbsp;                    throw new org.python.exceptions.RuntimeError(</b>
<b class="nc"><i class="no-highlight">553</i>&nbsp;                            e.getCause().getClass().getName() + &quot;: &quot; + message</b>
<i class="no-highlight">554</i>&nbsp;                    );
<i class="no-highlight">555</i>&nbsp;                }
<i class="no-highlight">556</i>&nbsp;            }
<i class="no-highlight">557</i>&nbsp;        // } finally {
<i class="no-highlight">558</i>&nbsp;            //     org.Python.debug(&quot;INVOKE METHOD DONE&quot;);
<i class="no-highlight">559</i>&nbsp;        }
<i class="no-highlight">560</i>&nbsp;    }
<i class="no-highlight">561</i>&nbsp;}
</div>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
        var codeBlock = document.getElementById('sourceCode');

        if (codeBlock) {
            hljs.highlightBlock(codeBlock);
        }
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2021-09-23 22:25</div>
</div>
</body>
</html>
